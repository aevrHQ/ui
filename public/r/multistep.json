{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "multistep",
  "type": "registry:component",
  "title": "Multistep",
  "description": "A multi-step form component.",
  "dependencies": [
    "iconsax-react",
    "lucide-react",
    "motion"
  ],
  "registryDependencies": [
    "@aevr/use-persisted-state",
    "@aevr/use-status",
    "button"
  ],
  "files": [
    {
      "path": "registry/lagos/ui/multistep.tsx",
      "content": "\"use client\";\n\nimport React, { useState, ReactNode, useCallback, useEffect } from \"react\";\nimport { usePersistedState } from \"@/hooks/aevr/use-persisted-state\";\nimport { useStatus, StatusRecord } from \"@/hooks/aevr/use-status\";\nimport { Button } from \"@/registry/lagos/ui/button\";\nimport { ArrowLeft, Icon } from \"iconsax-react\";\nimport { motion, AnimatePresence } from \"motion/react\";\n\nexport interface MinimalStepProps<T = unknown> {\n  values: T;\n  setValues: (values: T | ((prev: T) => T)) => void;\n  next: (values?: T) => void;\n  prev: () => void;\n  isFirst: boolean;\n  isLast: boolean;\n  status: StatusRecord;\n  setStatus: (key: string, item: unknown) => void;\n  goToStep: (step: number) => void;\n  isProcessing?: boolean;\n  stepInfo?: {\n    currentStep: number;\n    totalSteps: number;\n  };\n}\n\ninterface MinimalMultiStepProps<T> {\n  options?: {\n    showBackBtn?: boolean;\n  };\n  trigger?: ReactNode;\n  icon?: Icon | ReactNode;\n  title?: string;\n  description?: string;\n  steps: Array<(props: MinimalStepProps<T>) => ReactNode>;\n  initialValues: T;\n  storageKey?: string;\n  onComplete?: (values: T) => Promise<void> | void;\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  persist?: boolean;\n  stepProps?: Record<string, unknown>;\n  isProcessing?: boolean;\n}\n\nexport function MinimalMultiStep<T>({\n  icon,\n  title,\n  description,\n  steps,\n  initialValues,\n  storageKey,\n  onComplete,\n  open: controlledOpen,\n\n  persist = true,\n  options = {\n    showBackBtn: true,\n  },\n  isProcessing = false,\n  stepProps,\n}: MinimalMultiStepProps<T>) {\n  const [internalOpen] = useState(false);\n  const isOpen = controlledOpen ?? internalOpen;\n\n  const [currentStep, setCurrentStep] = useState(0);\n  const [direction, setDirection] = useState(0);\n\n  const variants = {\n    enter: (direction: number) => ({\n      x: direction > 0 ? 20 : -20,\n      opacity: 0,\n      filter: \"blur(4px)\",\n    }),\n    center: {\n      zIndex: 1,\n      x: 0,\n      opacity: 1,\n      filter: \"blur(0px)\",\n    },\n    exit: (direction: number) => ({\n      zIndex: 0,\n      x: direction < 0 ? 20 : -20,\n      opacity: 0,\n      filter: \"blur(4px)\",\n    }),\n  };\n\n  // Conditional hook usage is tricky. We'll use both and pick one based on persist prop.\n  // However, hooks cannot be conditional. So we always run both or refactor.\n  // Better approach: Use a custom hook or just use persisted state but clear it if persist is false?\n  // Or just use a wrapper.\n  // Let's use a simple state for non-persisted.\n\n  const persistedState = usePersistedState<T>(initialValues, {\n    storageKey: `${storageKey}_values`,\n  });\n\n  const simpleState = useState<T>(initialValues);\n\n  const values = persist ? persistedState.state : simpleState[0];\n  const setValues = persist ? persistedState.setState : simpleState[1];\n\n  // Reset state on close if not persisting\n  useEffect(() => {\n    if (!persist && !isOpen) {\n      const timer = setTimeout(() => {\n        setCurrentStep(0);\n        setValues(initialValues);\n      }, 0);\n      return () => clearTimeout(timer);\n    }\n  }, [isOpen, persist, initialValues, setValues]);\n\n  const { status, setStatus } = useStatus({\n    namespace: storageKey,\n  });\n\n  const next = useCallback(\n    async (providedValues?: T) => {\n      if (currentStep < steps.length - 1) {\n        setDirection(1);\n        setCurrentStep((prev) => prev + 1);\n      } else {\n        if (onComplete) {\n          await onComplete(providedValues || values);\n        }\n        // Optional: close dialog on complete?\n        // setOpen(false);\n      }\n    },\n    [currentStep, steps.length, onComplete, values],\n  );\n\n  const prev = useCallback(() => {\n    if (currentStep > 0) {\n      setDirection(-1);\n      setCurrentStep((prev) => prev - 1);\n    }\n  }, [currentStep]);\n\n  const goToStep = useCallback(\n    (step: number) => {\n      if (step >= 0 && step < steps.length) {\n        setDirection(step > currentStep ? 1 : -1);\n        setCurrentStep(step);\n      }\n    },\n    [steps.length, currentStep],\n  );\n\n  const CurrentStepComponent = steps[currentStep];\n\n  return (\n    <>\n      {/* Show MinimalMultistep header if icon or title or description is provided */}\n      {icon ||\n        title ||\n        (description && (\n          <div className=\"mb-2 flex flex-col items-center gap-2\">\n            <div className=\"flex items-center gap-2\">\n              {icon && (\n                <Icon\n                  className=\"icon h-6 w-6\"\n                  color=\"currentColor\"\n                  variant={\"Bulk\"}\n                />\n              )}\n              <div className=\"divider\"></div>\n              {title && <h2 className=\"text-lg font-semibold\">{title}</h2>}\n            </div>\n            {description && (\n              <p className=\"text-muted-foreground text-sm\">{description}</p>\n            )}\n          </div>\n        ))}\n      <div className=\"space-y-4 p-1\">\n        {/* Progress Indicator (Optional) */}\n        <div className=\"mb-4 flex items-center gap-2\">\n          {steps.map((_, idx) => (\n            <div\n              key={idx}\n              className={`h-1 flex-1 rounded-full transition-colors ${\n                idx <= currentStep ? \"bg-primary\" : \"bg-muted\"\n              }`}\n            />\n          ))}\n        </div>\n\n        {options?.showBackBtn && currentStep > 0 && (\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={prev}\n            className=\"text-muted-foreground hover:text-foreground mb-2 -ml-2\"\n            disabled={isProcessing}\n          >\n            <ArrowLeft\n              size={16}\n              className=\"\"\n              color=\"currentColor\"\n              variant=\"Bulk\"\n            />\n            Back\n          </Button>\n        )}\n\n        <AnimatePresence mode=\"wait\" custom={direction}>\n          <motion.div\n            key={currentStep}\n            custom={direction}\n            variants={variants}\n            initial=\"enter\"\n            animate=\"center\"\n            exit=\"exit\"\n            transition={{\n              x: { type: \"spring\", stiffness: 300, damping: 30 },\n              opacity: { duration: 0.2 },\n            }}\n          >\n            <CurrentStepComponent\n              {...stepProps}\n              values={values}\n              setValues={setValues}\n              next={next}\n              prev={prev}\n              isFirst={currentStep === 0}\n              isLast={currentStep === steps.length - 1}\n              status={status}\n              setStatus={setStatus as (key: string, item: unknown) => void}\n              goToStep={goToStep}\n              isProcessing={isProcessing}\n              stepInfo={{\n                currentStep,\n                totalSteps: steps.length,\n              }}\n            />\n          </motion.div>\n        </AnimatePresence>\n      </div>\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/ui/aevr/multistep.tsx"
    }
  ]
}